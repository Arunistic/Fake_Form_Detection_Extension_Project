<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Extension Diagnostic Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
        }
        .status {
            padding: 15px;
            margin: 10px 0;
            border-radius: 6px;
            font-weight: bold;
        }
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .info { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        pre {
            background: #f5f5f5;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <h1>üîç Extension Diagnostic Test</h1>
    
    <div id="status-container"></div>
    
    <h2>Step 1: Check if Extension is Loaded</h2>
    <button onclick="checkExtension()">Check Extension</button>
    <div id="extension-status"></div>
    
    <h2>Step 2: Test Form Submission</h2>
    <form id="test-form" action="http://fake-site.com/login" method="POST">
        <input type="text" name="username" placeholder="Username" value="test">
        <input type="password" name="password" placeholder="Password" value="test123">
        <button type="submit">Test Form Submit</button>
    </form>
    <div id="form-status"></div>
    
    <h2>Step 3: Check Console Logs</h2>
    <p>Open browser console (F12) and look for messages starting with <code>[FFD]</code></p>
    <button onclick="showConsoleHelp()">Show Console Help</button>
    <div id="console-help"></div>
    
    <script>
        function addStatus(message, type) {
            const container = document.getElementById('status-container');
            const div = document.createElement('div');
            div.className = `status ${type}`;
            div.textContent = message;
            container.appendChild(div);
        }
        
        function checkExtension() {
            const statusDiv = document.getElementById('extension-status');
            statusDiv.innerHTML = '';
            
            // Check if extension globals exist
            if (typeof window.__ffd !== 'undefined') {
                addStatus('‚úÖ Extension is loaded! window.__ffd exists', 'success');
                statusDiv.innerHTML += '<div class="status success">‚úÖ Extension functions found:<br>' + 
                    JSON.stringify(Object.keys(window.__ffd), null, 2) + '</div>';
            } else {
                addStatus('‚ùå Extension NOT loaded! window.__ffd not found', 'error');
                statusDiv.innerHTML += '<div class="status error">' +
                    'The extension content script may not be running.<br>' +
                    'Check: chrome://extensions/ ‚Üí Is extension enabled?<br>' +
                    'Reload the extension and this page.</div>';
            }
            
            // Check for ML detector
            if (typeof window.__ffd_ml !== 'undefined') {
                addStatus('‚úÖ ML Detector loaded!', 'success');
            } else {
                addStatus('‚ö†Ô∏è ML Detector not found', 'error');
            }
            
            // Check for domain list
            if (typeof window.__ffd_domainList !== 'undefined') {
                addStatus('‚úÖ Domain List Manager loaded!', 'success');
            } else {
                addStatus('‚ö†Ô∏è Domain List Manager not found', 'error');
            }
            
            // Check console for FFD logs
            setTimeout(() => {
                const logs = console.messages || [];
                if (logs.length > 0) {
                    addStatus('‚úÖ Console logs detected', 'success');
                } else {
                    addStatus('‚ö†Ô∏è No console logs found. Check browser console (F12)', 'info');
                }
            }, 1000);
        }
        
        document.getElementById('test-form').addEventListener('submit', function(e) {
            const statusDiv = document.getElementById('form-status');
            statusDiv.innerHTML = '<div class="status info">Form submit event fired. Check console for [FFD] messages.</div>';
            
            // Check if extension intercepted it
            setTimeout(() => {
                if (document.getElementById('__ffd_modal')) {
                    statusDiv.innerHTML += '<div class="status success">‚úÖ Extension intercepted form! Modal should be visible.</div>';
                } else {
                    statusDiv.innerHTML += '<div class="status error">‚ùå Extension did NOT intercept form. Check console for errors.</div>';
                }
            }, 500);
        });
        
        function showConsoleHelp() {
            const helpDiv = document.getElementById('console-help');
            helpDiv.innerHTML = `
                <div class="status info">
                    <strong>Expected Console Messages:</strong>
                    <pre>[FFD] ========================================
[FFD] Initializing Fake Form Detection Extension...
[FFD] Extension version: 1.0.0
[FFD] Found X forms on page
[FFD] Form handler attached to form: [object HTMLFormElement]
[FFD] ‚ö†Ô∏è SUBMIT EVENT FIRED!
[FFD] Form submission PREVENTED - analyzing...
[FFD] ‚ö†Ô∏è BLOCKING FORM SUBMISSION - Suspicious!</pre>
                    
                    <strong>If you don't see these messages:</strong>
                    <ul>
                        <li>Extension may not be loaded - check chrome://extensions/</li>
                        <li>Extension may be disabled - enable it</li>
                        <li>Reload the extension and this page</li>
                        <li>Check for JavaScript errors in console</li>
                    </ul>
                </div>
            `;
        }
        
        // Auto-check on load
        window.addEventListener('load', () => {
            setTimeout(() => {
                checkExtension();
                addStatus('Page loaded. Click "Check Extension" button above for detailed status.', 'info');
            }, 1000);
        });
    </script>
</body>
</html>
